@{
    ViewBag.Title = "HesaplariListele";
    Layout = "~/Views/_AdminMaster.cshtml";
}

@model B2B.Dto.AdminHesaplarIndex
<div class="row">
    <div class="col-sm-12">
        <div class="btn-group pull-right m-t-15">
            <button type="button" class="btn btn-default dropdown-toggle waves-effect waves-light" data-toggle="dropdown" aria-expanded="false">Seçenekler <span class="m-l-5"><i class="fa fa-cog"></i></span></button>
            <ul class="dropdown-menu" role="menu">
                <li><a href="/Admin/HesaplariListele?OrderBy=BakiyeArti">Bakiyesi Artıdan - Bakiye Eksiye</a></li>
                <li><a href="/Admin/HesaplariListele?OrderBy=BakiyeEksi">Bakiyesi Eksiden - Bakiye Artıya</a></li>
            </ul>
        </div>
    </div>
</div>

<!-- Page-Title -->
<h4 class="page-title">Anasayfa</h4>
<ol class="breadcrumb">
    <li>
        Yönetim
    </li>
    <li>
        Firmalar
    </li>
    <li class="active">
        Firmaları Görüntüle
    </li>
</ol>

<div class="row">
    <div class="col-lg-12">
        <div class="card-box">
            <div class="row">
                <div class="col-sm-8">
                    <form role="form">
                        <div class="form-group contact-search m-b-30">
                            <input type="text" id="search" class="form-control" placeholder="Arama yap...">
                            <button type="submit" class="btn btn-white"><i class="fa fa-search"></i></button>
                        </div>
                        <!-- form-group -->
                    </form>
                </div>
                <div class="col-sm-4">
                    <!-- Custom width modal -->
                    <button class="btn btn-primary waves-effect waves-light" data-toggle="modal" data-target="#con-close-modal"><i class="md md-add"></i>Yeni Firma Ekle</button>
                </div>
            </div>

            <div class="table-responsive">
                <table class="table dataTable table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>Firma</th>
                            <th>Yetkili</th>
                            <th>Kayıt Tarihi</th>
                            <th>Eylem</th>
                            <th>Bakiye</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Firmalar)
                        {
                            <tr>

                                <td>@item.FirmaAdi</td>
                                <td>
                                    <a href="#">@item.YetkiliKisi</a>
                                </td>
                                <td>@item.KayitTarihi</td>
                                <td>
                                    <button class="btn btn-icon waves-effect waves-light btn-warning href" href="/Admin/HesapDuzenle/@item.Id" data-toggle="tooltip" data-placement="top" data-original-title="Düzenle"> <i class="fa fa-wrench"></i> </button>
                                    <button class="btn btn-icon waves-effect btn-default waves-light hrefGo" href="/Admin/MuhasebeIslemleri_Index/@item.Id" data-toggle="tooltip" data-placement="top" data-original-title="Muhasebe İşlemleri"> <i class="fa fa-calculator"></i> </button>
                                </td>
                                <td>
                                    <span class="@{ if (item.FirmaMuhasebe.FirstOrDefault().Bakiye < 0)
                                                    {<text>text-danger</text>}
                                                    else
                                                    {<text>text-success</text>} }">@string.Format("{0:C}", item.FirmaMuhasebe.FirstOrDefault().Bakiye)</span>
                                                </td>
                                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

    </div>
    <!-- end col -->

</div>

<div class="col-lg-12">
    <div class="card-box m-b-0">
        <div class="p-20">
            <h4 class="m-b-20 header-title"><b>SON HAREKETLER</b></h4>
            <div class="nicescroll p-l-r-10" style="max-height: 535px;">
                <div class="timeline-2">
                    @foreach (var item in Model.Aktiviteler)
                    {
                        <div class="time-item">
                            <div class="item-info">
                                <div class="text-muted"><small>@item.SaatTarih</small></div>
                                <p>@item.Aktivite</p>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
<!-- modal baslangıc -->
<div id="con-close-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title">Yeni Firma Ekleyin</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="YetkiliKisi" class="control-label">Firma Yetkili Adı Soyadı</label>
                            <input type="text" class="form-control" id="YetkiliKisi" name="YetkiliKisi" placeholder="Ad Soyad Giriniz" required="required">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="FirmaAdi" class="control-label">Firma</label>
                            <input type="text" class="form-control" id="FirmaAdi" name="FirmaAdi" placeholder="Firma Ünvanı">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="FirmaUnvani" class="control-label">Fatura Başlığı</label>
                            <input type="text" class="form-control" id="FirmaUnvani" name="FirmaUnvani" placeholder="Firma Ünvanı">
                        </div>
                    </div>
                </div>
                 <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="FirmaUnvani" class="control-label">Vergi No</label>
                            <input type="text" class="form-control" id="VergiNo" name="VergiNo" placeholder="Vergi No">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="FirmaUnvani" class="control-label">Vergi Dairesi</label>
                            <input type="text" class="form-control" id="VergiDairesi" name="VergiDairesi" placeholder="Vergi Dairesi">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="Sehir" class="control-label">Şehir</label>
                            <select name="Sehir" id="Sehir" class="selectpicker">
                                <option value="0">Şehir Seçiniz</option>
                                <option value="1">Adana</option>
                                <option value="2">Adıyaman</option>
                                <option value="3">Afyonkarahisar</option>
                                <option value="4">Ağrı</option>
                                <option value="5">Amasya</option>
                                <option value="6">Ankara</option>
                                <option value="7">Antalya</option>
                                <option value="8">Artvin</option>
                                <option value="9">Aydın</option>
                                <option value="10">Balıkesir</option>
                                <option value="11">Bilecik</option>
                                <option value="12">Bingöl</option>
                                <option value="13">Bitlis</option>
                                <option value="14">Bolu</option>
                                <option value="15">Burdur</option>
                                <option value="16">Bursa</option>
                                <option value="17">Çanakkale</option>
                                <option value="18">Çankırı</option>
                                <option value="19">Çorum</option>
                                <option value="20">Denizli</option>
                                <option value="21">Diyarbakır</option>
                                <option value="22">Edirne</option>
                                <option value="23">Elazığ</option>
                                <option value="24">Erzincan</option>
                                <option value="25">Erzurum</option>
                                <option value="26">Eskişehir</option>
                                <option value="27">Gaziantep</option>
                                <option value="28">Giresun</option>
                                <option value="29">Gümüşhane</option>
                                <option value="30">Hakkâri</option>
                                <option value="31">Hatay</option>
                                <option value="32">Isparta</option>
                                <option value="33">Mersin</option>
                                <option value="34">İstanbul</option>
                                <option value="35">İzmir</option>
                                <option value="36">Kars</option>
                                <option value="37">Kastamonu</option>
                                <option value="38">Kayseri</option>
                                <option value="39">Kırklareli</option>
                                <option value="40">Kırşehir</option>
                                <option value="41">Kocaeli</option>
                                <option value="42">Konya</option>
                                <option value="43">Kütahya</option>
                                <option value="44">Malatya</option>
                                <option value="45">Manisa</option>
                                <option value="46">Kahramanmaraş</option>
                                <option value="47">Mardin</option>
                                <option value="48">Muğla</option>
                                <option value="49">Muş</option>
                                <option value="50">Nevşehir</option>
                                <option value="51">Niğde</option>
                                <option value="52">Ordu</option>
                                <option value="53">Rize</option>
                                <option value="54">Sakarya</option>
                                <option value="55">Samsun</option>
                                <option value="56">Siirt</option>
                                <option value="57">Sinop</option>
                                <option value="58">Sivas</option>
                                <option value="59">Tekirdağ</option>
                                <option value="60">Tokat</option>
                                <option value="61">Trabzon</option>
                                <option value="62">Tunceli</option>
                                <option value="63">Şanlıurfa</option>
                                <option value="64">Uşak</option>
                                <option value="65">Van</option>
                                <option value="66">Yozgat</option>
                                <option value="67">Zonguldak</option>
                                <option value="68">Aksaray</option>
                                <option value="69">Bayburt</option>
                                <option value="70">Karaman</option>
                                <option value="71">Kırıkkale</option>
                                <option value="72">Batman</option>
                                <option value="73">Şırnak</option>
                                <option value="74">Bartın</option>
                                <option value="75">Ardahan</option>
                                <option value="76">Iğdır</option>
                                <option value="77">Yalova</option>
                                <option value="78">Karabük</option>
                                <option value="79">Kilis</option>
                                <option value="80">Osmaniye</option>
                                <option value="81">Düzce</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="FirmaTelefon" class="control-label">Firma Telefon</label>
                            <input type="text" placeholder="" data-mask="(999) 999-9999" class="form-control" id="FirmaTelefon" name="FirmaTelefon">
                            <span class="font-13 text-muted">Ör: (324) 221-2121</span>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="Faks" class="control-label">FAX</label>
                            <input type="text" placeholder="" data-mask="(999) 999-9999" class="form-control" name="Faks" id="Faks">
                            <span class="font-13 text-muted">Ör: (324) 221-2121</span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group no-margin">
                            <label for="FirmaIskonto" class="control-label">İskonto Oranı</label>
                            <input id="FirmaIskonto" type="text" value="0" name="FirmaIskonto" data-bts-min="0" data-bts-max="100" data-bts-init-val="" data-bts-step="1" data-bts-decimal="0" data-bts-step-interval="100" data-bts-force-step-divisibility="round" data-bts-step-interval-delay="500" data-bts-prefix="" data-bts-postfix="" data-bts-prefix-extra-class="" data-bts-postfix-extra-class="" data-bts-booster="true" data-bts-boostat="10" data-bts-max-boosted-step="false" data-bts-mousewheel="true" data-bts-button-down-class="btn btn-default" data-bts-button-up-class="btn btn-default" />
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group no-margin">
                            <div class="checkbox checkbox-purple checkbox-circle">
                                <input name="CariHesapIzni" id="CariHesapIzni" type="checkbox">
                                <label for="CariHesapIzni">
                                    Bu Firmaya Cari Hesap Aç
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                
                <button type="button" id="closeModal" class="btn btn-danger waves-effect" data-dismiss="modal">İptal</button>
                <button type="button" id="saveChanges" class="btn btn-success waves-effect waves-light">Firmayı Kaydet</button>
            </div>
        </div>
    </div>
</div>
<!-- /.modal -->
<div id="hrefModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title">Firma Düzenleyin</h4>
            </div>
            <div class="modal-body">
             
            </div>
            <div class="modal-footer">
                <button type="button" id="deleteCompany" class="btn btn-danger waves-effect">Firmayı ve tüm cari kayıtlarını sil</button>
                <button type="button" id="closeModal" class="btn btn-danger waves-effect" data-dismiss="modal">İptal</button>
                <button type="button" id="DuzenleKaydet" class="btn btn-success waves-effect waves-light">Değişiklikleri Kaydet</button>
            </div>
        </div>
    </div>
</div>
<!-- /.modal -->
<!-- Modal-Effect -->
<script src="/assets/plugins/custombox/dist/custombox.min.js"></script>
<script src="/assets/plugins/custombox/dist/legacy.min.js"></script>
<!-- Bootstrap-touchspin  -->
<script src="/assets/plugins/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.js" type="text/javascript"></script>

<!-- Bootstrap-select  -->
<script src="/assets/plugins/bootstrap-select/dist/js/bootstrap-select.min.js" type="text/javascript"></script>
<!-- Bootstrap inputmask -->
<script src="/assets/plugins/bootstrap-inputmask/bootstrap-inputmask.min.js" type="text/javascript"></script>
<!-- Sweet-Alert  -->
<script src="/assets/plugins/sweetalert/dist/sweetalert.min.js"></script>
<script src="/assets/pages/jquery.sweet-alert.init.js"></script>
<script>
    $('#deleteCompany').click(function () {
        swal({
            title: "Dikkat!",
            text: "Firmaya ait tüm muhasebe kayıtları dahil silinecektir. Bu işlemi onaylıyor musunuz?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Evet, Onaylıyorum!",
            cancelButtonText: "Vazgeç!",
            closeOnConfirm: false,
            closeOnCancel: false
        },
        function (isConfirm) {
            if (isConfirm) {
                $.post('@Url.Content("~/")Admin/FirmaSil', {
                    'FirmaId': $('#HiddenId').val()
                }, function (d) {
                    if (d.Error == "success") {
                        swal("Başarılı!", d.ReturnMsg, d.Error);
                        $('#hrefModal .modal-body').html("<img src='/assets/images/gallery/loading.gif' style='width:20px'> Lütfen bekleyiniz.");
                        setTimeout(function () { location.reload(); }, 3000);
                    }
                    else {
                        swal("Hata Oluştu!", d.ReturnMsg, d.Error);
                    }
                });
            }
            else {
                swal("İptal", "İsteğiniz üzere işlem iptal edildi", "error");
            }
        });
    });
    $(".nicescroll").niceScroll();
    $("input[name='FirmaIskonto']").TouchSpin({
        min: 0, max: 100
    });
    $('#saveChanges').click(function () {
        swal({
            title: "Girdiğiniz bilgileri Onaylıyor musunuz?",
            text: "Verilerin doğru girildiğini onaylamak için evet onaylıyorum tuşuna basın.",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Evet, Bilgileri Onaylıyorum!",
            cancelButtonText: "Vazgeç!",
            closeOnConfirm: false,
            closeOnCancel: false
        },
        function (isConfirm) {
            if (isConfirm) {
                if ($('#CariHesapIzni').attr('checked') == true) {
                    $('#CariHesapIzni').val('1');

                }
                else {
                    $('#CariHesapIzni').val('0');
                }
                $.post('@Url.Content("~/")Admin/FirmaKaydetveyaGuncelle', {
                    'FirmaAdi': $('#FirmaAdi').val(),
                    'FirmaUnvani': $('#FirmaUnvani').val(),
                    'YetkiliKisi': $('#YetkiliKisi').val(),
                    'FirmaTelefon': $('#FirmaTelefon').val(),
                    'BayiKodu': $('#BayiKodu').val(),
                    'FirmaIskonto': $('#FirmaIskonto').val(),
                    'CariHesapIzni': $('#CariHesapIzni').val(),
                    'Sehir': $('#Sehir option:selected').text(),
                    'KayitTarihi': '@DateTime.Today',
                    'VergiNo' : $('#VergiNo').val() ,
                    'VergiDairesi': $('#VergiDairesi').val(),
                    'Faks': $('#Faks').val(),
                }, function (d) {
                    if (d.Error == "success") {
                        swal("Başarılı!", d.ReturnMsg, d.Error);
                        $('#con-close-modal').modal('toggle');
                        setTimeout(function () { location.reload(); }, 3000);
                    }
                    else {
                        swal("Hata Oluştu!", d.ReturnMsg, d.Error);
                        $('#con-close-modal').modal('toggle');
                    }
                });
            }
            else {
                swal("İptal", "İsteğiniz üzere işlem iptal edildi", "error");
            }
        }
        )
    });
</script>
<script>
    $('[data-toggle="tooltip"]').tooltip();
    $('.href').on('click', function (e) {
        e.preventDefault();
        $('#hrefModal').modal('show').find('.modal-body').load($(this).attr('href'));
    });
    $('.modal').on('hidden.bs.modal', function (e) {
        $(this).removeData();
    });
    $('#hrefModal').on('show.bs.modal', function () {
        $('#hrefModal .modal-body').html("<img src='/assets/images/gallery/loading.gif' style='width:20px'> Lütfen bekleyiniz.");
    })
    $('#DuzenleKaydet').click(function() {
        $.post('@Url.Content("~/")Admin/FirmaKaydetveyaGuncelle', {
            'Id' : $('#HiddenId').val(),
            'FirmaAdi': $('#FirmaAdi-Duzenle').val(),
            'FirmaUnvani': $('#FirmaUnvani-Duzenle').val(),
            'YetkiliKisi': $('#YetkiliKisi-Duzenle').val(),
            'FirmaTelefon': $('#FirmaTelefon-Duzenle').val(),
            'BayiKodu': $('#BayiKodu').val(),
            'FirmaIskonto': $('#FirmaIskonto-Duzenle').val(),
            'CariHesapIzni': $("#CariHesapIzni-Duzenle").prop('checked') == true ? "1":"0",
            'Sehir': $('#Sehir-Duzenle option:selected').text(),
            'VergiNo': $('#VergiNo-Duzenle').val(),
            'VergiDairesi': $('#VergiDairesi-Duzenle').val(),
            'Faks': $('#Faks-Duzenle').val(),
        }, function (d) {
            swal("Bilgi!", d.ReturnMsg, d.Error);
            $('#hrefModal').modal('toggle');
        });
    });
    $('.hrefGo').click(function () {
        window.location.href = $(this).attr('href');
    });
</script>
<!-- Datatable js -->
<script src="/assets/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="/assets/plugins/datatables/dataTables.bootstrap.js"></script>
<script src="/assets/plugins/datatables/dataTables.keyTable.min.js"></script>
<script src="/assets/plugins/datatables/dataTables.buttons.min.js"></script>
<script src="/assets/plugins/datatables/buttons.bootstrap.min.js"></script>
<script src="/assets/plugins/datatables/jszip.min.js"></script>
<script src="/assets/plugins/datatables/pdfmake.min.js"></script>
<script src="/assets/plugins/datatables/vfs_fonts.js"></script>
<script src="/assets/plugins/datatables/buttons.html5.min.js"></script>
<script src="/assets/plugins/datatables/buttons.print.min.js"></script>
<!-- Data table init -->
<script src="/assets/pages/datatables.init.js"></script>
<script type="text/javascript">
    TableManageButtons.init();
</script>